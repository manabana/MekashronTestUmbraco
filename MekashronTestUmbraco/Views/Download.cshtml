@using Umbraco.Cms.Web.Common.PublishedModels;
@inherits Umbraco.Cms.Web.Common.Views.UmbracoViewPage

@{
    Guid indexPageId = Guid.Parse("41e0ccdd-4a1d-4aa8-a022-abc7d5555024");
    IPublishedContent? indexPage = Umbraco.Content(indexPageId);
    if (indexPage is null) throw new Exception("index page not found");
}


<!DOCTYPE html>
<html lang="en">

@await Html.PartialAsync("Partials/Head")

<body>
    <div class="site" id="page">

        @await Html.PartialAsync("Partials/Header")

        <main class="main" id="primary">
            <section class="breadcrumbs">
                <div class="container">
                    <h1 style="text-align: center; ">@Model.Value("title")</h1>
                </div>
            </section>
            <section class="info">
                <div class="container">
                    <p style="text-align: center;">
                        @Html.Raw(Model.Value<String>("description")?.Replace("\n", "<br>"))
                    </p>
                    <p style="text-align: center; color: #800000;">
                        @Model.Value("warningText")
                    </p>
                    <form id="registerForm">
                        <div class="form-group">
                            <label for="name">@Model.Value("NameField")</label>
                            <input type="text" id="name" name="Name">
                        </div>
                        <div class="form-group">
                            <label for="company">@Model.Value("CompanyNameField")</label>
                            <input type="text" id="company" name="Company">
                        </div>
                        <div class="form-group">
                            <label for="phone">@Model.Value("PhoneField")</label>
                            <input type="tel" id="phone" name="Phone">
                        </div>
                        <div class="form-group">
                            <label for="email">@Model.Value("EmailField")</label>
                            <input type="email" id="email" name="Email">
                        </div>
                        <button class="button button--accent" type="submit">@Model.Value("submit")</button>
                    </form>

                    <div id="registerResult" style="margin-top:16px;color:#003300"></div>
                </div>
            </section>
    </main>

	    @await Html.PartialAsync("Partials/Footer")

    </div>

    <script src="@(Url.Content("~/assets/js/jquery-3.7.1.min.js"))"></script>
    <script src="@(Url.Content("~/assets/js/swiper-bundle.min.js"))"></script>
    <script src="@(Url.Content("~/assets/js/select.js"))"></script>
    <script src="@(Url.Content("~/assets/js/scripts.js"))"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            var form = document.getElementById('registerForm');
            if (!form) return;

            form.addEventListener('submit', async function (e) {
                e.preventDefault();

                var data = {
                    Name: form.querySelector('[name="Name"]').value,
                    Company: form.querySelector('[name="Company"]').value,
                    Phone: form.querySelector('[name="Phone"]').value,
                    Email: form.querySelector('[name="Email"]').value
                };

                var btn = form.querySelector('button[type="submit"]');
                if (btn) {
                    btn.disabled = true;
                    btn.textContent = 'Sending...';
                }

                var resultDiv = document.getElementById('registerResult');

                try {
                    var res = await fetch('/api/register', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(data)
                    });

                    if (!res.ok) {
                        var err = await res.json().catch(function () { return { error: 'Unknown error' }; });
                        resultDiv.style.color = '#800000';
                        resultDiv.textContent = err.error || err.message || JSON.stringify(err);
                    } else {
                        var json = await res.json();
                        resultDiv.style.color = '#003300';
                        // display the whole response; adjust as needed to show specific fields
                        resultDiv.textContent = 'Success: ' + JSON.stringify(json);
                    }
                } catch (ex) {
                    resultDiv.style.color = '#800000';
                    resultDiv.textContent = 'Network error: ' + (ex && ex.message ? ex.message : ex);
                } finally {
                    if (btn) {
                        btn.disabled = false;
                        btn.textContent = '@Model.Value("submit")';
                    }
                }
            });
        });
    </script>

</body>

</html>